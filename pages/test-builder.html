
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Test Builder</title>
  <style>
    :root{--bg:#ffff;--card:#0b1220;--muted:#9aa4b2;--accent:#5eead4;--glass: rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{font-family:Inter,Segoe UI,Roboto,system-ui,Arial;background:linear-gradient(180deg,#ffff 0%, #ffff 100%);color:#e6eef6;margin:0;padding:28px}
    .app{max-width:1100px;margin:0 auto}
    header{display:flex;align-items:center;gap:16px;margin-bottom:20px}
    header h1{font-size:20px;margin:0}
    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(23, 2, 3, 0.6)}

    /* Wizard */
    .wizard{display:grid;grid-template-columns:260px 1fr;gap:18px}
    .steps{background:linear-gradient(180deg, rgba(10, 3, 3, 0.46), transparent);padding:12px;border-radius:10px}
    .step-item{display:flex;align-items:center;gap:12px;padding:10px;border-radius:8px;margin-bottom:8px;cursor:pointer}
    .step-item.active{background:var(--glass);outline:1px solid rgba(255,255,255,0.03)}
    .step-item small{color:var(--muted)}

    .panel{padding:12px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text],select,input[type=number],textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    textarea{min-height:100px}

    .row{display:flex;gap:12px}
    .col{flex:1}
    .muted{color:var(--muted);font-size:13px}

    .sections-list{margin-top:12px}
    .section-card{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:8px}
    .section-card .meta{display:flex;gap:10px;align-items:center}
    .btn{background:linear-gradient(90deg,#0ea5a3,#34d399);border:none;padding:8px 12px;border-radius:8px;color:#042018;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .btn.warn{background:linear-gradient(90deg,#fca5a5,#fb7185);color:#2b021e}
    .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:16px}

    .toggle{display:inline-flex;align-items:center;gap:8px}
    .switch{width:44px;height:24px;background:rgba(255,255,255,0.06);border-radius:999px;padding:3px;display:inline-flex;align-items:center;cursor:pointer}
    .knob{width:18px;height:18px;background:white;border-radius:50%;transition:transform .18s}
    .switch.on{background:linear-gradient(90deg,#34d399,#10b981)}
    .switch.on .knob{transform:translateX(20px)}

    .summary table{width:100%;border-collapse:collapse}
    .summary th,.summary td{padding:10px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.03)}

    .footer-note{font-size:13px;color:var(--muted);margin-top:10px}

    /* responsive */
    @media (max-width:900px){.wizard{grid-template-columns:1fr}.steps{display:flex;overflow:auto}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo card" style="padding:10px;border-radius:10px">TS</div>
      <div>
        <h1 style="color:#000;">Test Builder</h1>
        <div class="muted">Create mock/live tests, add sections, configure marking & shuffling</div>
      </div>
    </header>

    <div class="card wizard">
      <aside class="steps">
        <div class="step-item active" data-step="1"><div><strong>1.</strong></div><div><div><strong>Basic Info</strong></div><small>Test name, type, duration</small></div></div>
        <div class="step-item" data-step="2"><div><strong>2.</strong></div><div><div><strong>Sections</strong></div><small>Add, marks, negative</small></div></div>
        <div class="step-item" data-step="3"><div><strong>3.</strong></div><div><div><strong>Advanced</strong></div><small>Shuffle & settings</small></div></div>
        <div class="step-item" data-step="4"><div><strong>4.</strong></div><div><div><strong>Review</strong></div><small>Save / Publish</small></div></div>
      </aside>
<main class="panel" id="panel"></main>
    </div>

    

  <script>
    
    const state = {
      step: 1,
      test: {
        name:'',
        type:'Mock',
        duration:60,
        tags:[],
        sections:[],
        shuffleQuestions:false,
        shuffleOptions:false
      }
    }

    const DRAFT_KEY = 'test_builder_draft_v1'
    const saved = localStorage.getItem(DRAFT_KEY)
    if(saved){
      try{const parsed = JSON.parse(saved); state.test = Object.assign(state.test, parsed)}catch(e){console.warn('invalid draft')}
    }

    const panel = document.getElementById('panel')
    const steps = document.querySelectorAll('.step-item')
    steps.forEach(s=>s.addEventListener('click',()=>{ goToStep(Number(s.dataset.step)) }))

    function goToStep(n){ state.step = n; render(); highlightStep() }
    function highlightStep(){ steps.forEach(s=>s.classList.toggle('active', Number(s.dataset.step)===state.step)) }

    function render(){
      panel.innerHTML = ''
      if(state.step===1) renderStep1()
      if(state.step===2) renderStep2()
      if(state.step===3) renderStep3()
      if(state.step===4) renderStep4()
    }

    // ---------- Step 1: Basic Info ----------
    function renderStep1(){
      const html = document.createElement('div')
      html.innerHTML = `
        <h2>Basic Info</h2>
        <div class="row" style="margin-top:12px">
          <div class="col">
            <label>Test Name *</label>
            <input id="testName" type="text" placeholder="Enter test name" value="${escapeHTML(state.test.name)}">
          </div>
          <div style="width:160px">
            <label>Type</label>
            <select id="testType"><option>Mock</option><option>Live</option></select>
          </div>
        </div>
        <div style="margin-top:12px" class="row">
          <div style="width:180px">
            <label>Duration (minutes)</label>
            <input id="duration" type="number" min="1" value="${state.test.duration}">
          </div>
          <div class="col">
            <label>Tags / Subjects (comma separated)</label>
            <input id="tags" type="text" placeholder="Maths, Reasoning" value="${escapeHTML(state.test.tags.join(','))}">
          </div>
        </div>
        <div class="actions">
          <button class="btn ghost" id="toStep2">Next: Sections ▶</button>
        </div>
      `
      panel.appendChild(html)

      document.getElementById('testName').addEventListener('input',e=>{ state.test.name = e.target.value; autoSave() })
      document.getElementById('testType').value = state.test.type
      document.getElementById('testType').addEventListener('change',e=>{ state.test.type = e.target.value; autoSave() })
      document.getElementById('duration').addEventListener('input',e=>{ state.test.duration = Number(e.target.value); autoSave() })
      document.getElementById('tags').addEventListener('input',e=>{ state.test.tags = e.target.value.split(',').map(s=>s.trim()).filter(Boolean); autoSave() })
      document.getElementById('toStep2').addEventListener('click',()=>{ goToStep(2) })
    }

    // ---------- Step 2: Sections ----------
    function renderStep2(){
      const html = document.createElement('div')
      html.innerHTML = `
        <h2>Sections</h2>
        <div class="muted">Add sections with per-question marks and negative marking.</div>
        <div style="margin-top:12px">
          <div style="display:flex;gap:8px">
            <input id="sectionName" type="text" placeholder="Section name (e.g., Mathematics)" style="flex:1">
            <input id="sectionQCount" type="number" placeholder="#Q" style="width:84px">
            <input id="sectionMarks" type="number" placeholder="Marks/Q" style="width:110px">
            <button class="btn" id="addSectionBtn">Add Section</button>
          </div>
        </div>
        <div class="sections-list" id="sectionsList"></div>
        <div class="actions">
          <button class="btn ghost" id="backTo1">◀ Back</button>
          <button class="btn" id="toStep3">Next: Advanced ▶</button>
        </div>
      `
      panel.appendChild(html)

      document.getElementById('backTo1').addEventListener('click',()=>goToStep(1))
      document.getElementById('toStep3').addEventListener('click',()=>goToStep(3))
      document.getElementById('addSectionBtn').addEventListener('click',addSectionFromInputs)

      renderSectionsList()
    }

    function addSectionFromInputs(){
      const name = document.getElementById('sectionName').value.trim()
      const qcount = Number(document.getElementById('sectionQCount').value||0)
      const marks = Number(document.getElementById('sectionMarks').value||1)
      if(!name || qcount<=0){ alert('Please provide section name and valid question count'); return }
      state.test.sections.push({id:Date.now(),name,questions:qcount,marksPerQ:marks,negative:0})
      document.getElementById('sectionName').value=''
      document.getElementById('sectionQCount').value=''
      document.getElementById('sectionMarks').value=''
      renderSectionsList(); autoSave()
    }

    function renderSectionsList(){
      const container = document.getElementById('sectionsList')
      container.innerHTML = ''
      if(state.test.sections.length===0){ container.innerHTML = '<div class="muted" style="padding:12px">No sections yet. Add one above.</div>' ; return }
      state.test.sections.forEach(s=>{
        const div = document.createElement('div')
        div.className='section-card'
        div.innerHTML = `
          <div class="meta">
            <div><strong>${escapeHTML(s.name)}</strong></div>
            <div class="muted">${s.questions} Qs • ${s.marksPerQ} marks/Q • neg ${s.negative}</div>
          </div>
          <div style="display:flex;gap:8px">
            <button class="btn ghost" data-action="edit" data-id="${s.id}">Edit</button>
            <button class="btn warn" data-action="delete" data-id="${s.id}">Delete</button>
          </div>
        `
        container.appendChild(div)
      })
      container.querySelectorAll('button').forEach(b=>b.addEventListener('click',e=>{
        const id = Number(e.target.dataset.id)
        const action = e.target.dataset.action
        if(action==='delete'){ state.test.sections = state.test.sections.filter(x=>x.id!==id); renderSectionsList(); autoSave() }
        if(action==='edit'){ openEditModal(id) }
      }))
    }

    function openEditModal(id){
      const s = state.test.sections.find(x=>x.id===id)
      if(!s) return
      const name = prompt('Section name', s.name)
      if(name===null) return
      const q = prompt('Number of questions', s.questions)
      if(q===null) return
      const marks = prompt('Marks per question', s.marksPerQ)
      if(marks===null) return
      const neg = prompt('Negative marking (enter 0 to disable)', s.negative)
      if(neg===null) return
      s.name = name.trim() || s.name
      s.questions = Number(q)||s.questions
      s.marksPerQ = Number(marks)||s.marksPerQ
      s.negative = Number(neg)||0
      renderSectionsList(); autoSave()
    }

    // ---------- Step 3: Advanced ----------
    function renderStep3(){
      const html = document.createElement('div')
      html.innerHTML = `
        <h2>Advanced Settings</h2>
        <div style="display:flex;gap:12px;align-items:center;margin-top:12px">
          <div>
            <label>Shuffle Questions</label>
            <div class="toggle"><div id="shuffleQ" class="switch"></div></div>
          </div>
          <div>
            <label>Shuffle Options</label>
            <div class="toggle"><div id="shuffleO" class="switch"></div></div>
          </div>
        </div>

        <div style="margin-top:14px">
          <label>Additional settings</label>
          <div class="row">
            <div class="col">
              <label>Auto-save (local)</label>
              <div class="muted">Drafts are saved in browser localStorage automatically.</div>
            </div>
          </div>
        </div>

        <div class="actions">
          <button class="btn ghost" id="backTo2">◀ Back</button>
          <button class="btn" id="toStep4">Next: Review ▶</button>
        </div>
      `
      panel.appendChild(html)

      const swQ = document.getElementById('shuffleQ')
      const swO = document.getElementById('shuffleO')
      function updateSwitch(el, on){ el.classList.toggle('on', !!on); el.innerHTML = '<div class="knob"></div>' }
      updateSwitch(swQ, state.test.shuffleQuestions)
      updateSwitch(swO, state.test.shuffleOptions)
      swQ.addEventListener('click',()=>{ state.test.shuffleQuestions = !state.test.shuffleQuestions; updateSwitch(swQ,state.test.shuffleQuestions); autoSave() })
      swO.addEventListener('click',()=>{ state.test.shuffleOptions = !state.test.shuffleOptions; updateSwitch(swO,state.test.shuffleOptions); autoSave() })

      document.getElementById('backTo2').addEventListener('click',()=>goToStep(2))
      document.getElementById('toStep4').addEventListener('click',()=>goToStep(4))
    }

    // ---------- Step 4: Review & Save ----------
    function renderStep4(){
      const html = document.createElement('div')
      html.innerHTML = `
        <h2>Review & Save</h2>
        <div class="summary card" style="margin-top:12px;padding:12px">
          <table>
            <tr><th>Test name</th><td id="r_name"></td></tr>
            <tr><th>Type</th><td id="r_type"></td></tr>
            <tr><th>Duration</th><td id="r_duration"></td></tr>
            <tr><th>Tags</th><td id="r_tags"></td></tr>
            <tr><th>Sections</th><td id="r_sections"></td></tr>
            <tr><th>Shuffle Q / O</th><td id="r_shuffle"></td></tr>
          </table>
        </div>

        <div class="actions">
          <button class="btn ghost" id="backTo3">◀ Back</button>
          <button class="btn ghost" id="saveDraft">Save Draft</button>
          <button class="btn" id="publish">Publish</button>
        </div>

        <div class="footer-note">Publishing simulates finalizing the test for scheduling. This demo does not connect to a backend.</div>
      `
      panel.appendChild(html)

      document.getElementById('backTo3').addEventListener('click',()=>goToStep(3))
      document.getElementById('saveDraft').addEventListener('click',saveDraft)
      document.getElementById('publish').addEventListener('click',publish)

      // fill values
      document.getElementById('r_name').textContent = state.test.name || '(untitled)'
      document.getElementById('r_type').textContent = state.test.type
      document.getElementById('r_duration').textContent = state.test.duration + ' minutes'
      document.getElementById('r_tags').textContent = state.test.tags.join(', ') || '-'
      document.getElementById('r_shuffle').textContent = (state.test.shuffleQuestions? 'Yes':'No') + ' / ' + (state.test.shuffleOptions? 'Yes':'No')

      const secCell = document.getElementById('r_sections')
      if(state.test.sections.length===0){ secCell.textContent = 'No sections added' } else {
        const ul = document.createElement('div')
        ul.innerHTML = state.test.sections.map(s=>`• ${escapeHTML(s.name)} — ${s.questions} Qs, ${s.marksPerQ} marks/Q, neg ${s.negative}`).join('<br>')
        secCell.appendChild(ul)
      }
    }

    // ---------- Helpers ----------
    function saveDraft(){
      localStorage.setItem(DRAFT_KEY, JSON.stringify(state.test))
      toast('Draft saved locally')
    }
    function autoSave(){

      try{ localStorage.setItem(DRAFT_KEY, JSON.stringify(state.test)) }catch(e){}
    }
    function publish(){
      if(!state.test.name){ if(!confirm('Test has no name. Publish anyway?')) return }
  
      const published = Object.assign({},state.test,{publishedAt:new Date().toISOString(),status:'published'})
 
      const key = 'published_tests_v1'
      const arr = JSON.parse(localStorage.getItem(key)||'[]')
      arr.push(published)
      localStorage.setItem(key, JSON.stringify(arr))
      toast('Test published — saved in browser storage (simulated)')
      
    }

    function toast(msg){
      const el = document.createElement('div')
      el.textContent = msg
      Object.assign(el.style,{position:'fixed',right:'20px',bottom:'20px',padding:'10px 14px',background:'#072f2a',borderRadius:'8px',boxShadow:'0 8px 30px rgba(2,6,23,0.6)',color:'#bfffe8'})
      document.body.appendChild(el)
      setTimeout(()=>el.style.opacity='0.01',2400)
      setTimeout(()=>el.remove(),3000)
    }

    function escapeHTML(s){ return String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;') }

   
    render(); highlightStep()

  </script>
</body>
</html>

